
@{
    ViewBag.Title = "Tree";
    Layout = "~/Views/Shared/AssociateLayout.cshtml";
}

<link href="../../css/tree-responsive.css" rel="stylesheet" />
<link href="../../css/tree.css" rel="stylesheet" />
<style type="text/css">
    .ui-autocomplete-loading {
        background: white url("../img/player_loading.gif") right center no-repeat;
        background-size: 20px;
    }

    .ps-scrollbar-x {
        display: none;
    }

    .card-box {
        padding: 19px;
        -webkit-border-radius: 5px;
        border-radius: 5px;
        -moz-border-radius: 5px;
        background-clip: padding-box;
        margin-bottom: 20px;
        background-color: black;
        box-shadow: 0 0 24px 0 rgba(0, 0, 0, 0.06), 0 1px 0 0 rgba(0, 0, 0, 0.02);
    }

    .h3 {
        font-size: 10px !important;
    }

    .tree {
        -webkit-transition-property: opacity; /* Safari */
        -webkit-transition-duration: 5s; /* Safari */
        -webkit-transition-delay: 0.5s; /* Safari */
        transition-property: opacity;
        transition-duration: 5s;
        transition-delay: 0.5s;
    }

    #firstRow, [id*="level"] {
        /*display: none;*/
        transition-property: display;
        transition-duration: 3s;
        transition-delay: 1s;
    }

    #firstHead {
        opacity: 0;
        transition-property: display;
        transition-duration: 3s;
        transition-delay: 1s;
    }

    .tree ul {
        margin: auto;
        width: max-content;
        float: none !important;
    }

        .tree ul li {
            left: 1%;
        }

    .tree li a {
        width: 100px;
        height: auto;
        border: 0;
        padding: 0;
        /*background-color: antiquewhite;*/
    }

    .tree a b {
        font-size: smaller;
        color: #29166f;
    }

    .tree a span {
        font-size: 9px;
        line-height: 12px;
        color: #0093dd;
        text-transform: uppercase;
        display: block;
    }

        .tree a span.name {
            color: #929294;
        }

    .side-panel {
        position: fixed;
        display: block;
        border: 1px solid;
        background-color: #FFC40D;
        z-index: 9;
        right: 0;
        border-color: #FFC40D;
        top: 160px;
        height: 100%;
        width: 20%;
        right: -20%;
        transition: all 0.3s;
    }

    .active {
        transition: all 0.3s;
        right: 0;
    }

    #myDiv {
        margin: auto;
        margin-top: 300px;
        text-align: center;
    }

    #chart {
        min-height: 450px !important;
        height: 100%;
        /*background-color: #000000e6;*/
        width: 100% !important;
        padding: 0px;
        overflow: hidden;
    }

    .loading {
        background-image: url(../Content/img/player_loading.gif);
        background-position: right;
        background-repeat: no-repeat;
        background-size: 20px;
    }

    .tree a {
        /*font-weight: bold;
            font-family: verdana;*/
    }

        .tree a span {
            /*position: absolute;*/
            left: 0;
            right: 0;
            font-weight: 100;
            font-family: verdana;
            font-size: 9px;
            color: #0558b1;
            display: block;
        }

    .tree li a:hover span {
        /*position: absolute;*/
        left: 0;
        right: 0;
    }


    .popover {
        background: #f5f5f5 !important;
        max-width: 400px;
        webkit-box-shadow: 0px 0px 15px 0px rgba(0,0,0,0.45);
        -moz-box-shadow: 0px 0px 15px 0px rgba(0,0,0,0.45);
        box-shadow: 0px 0px 15px 0px rgba(0,0,0,0.45);
    }

    .popover-title {
        display: none !important;
    }



    .popover-content {
        float: left;
        width: 100%;
        color: #29292b;
        font-size: 13px;
        background: #f5f5f5 !important;
    }



        .popover-content .table td, .popover-content .table th {
            font-size: 11px;
            border: 1px solid black;
            border-left: 1px solid black;
            word-wrap: break-word !important;
            padding: 2px 2px;
            word-break: break-all;
            background: #f5f5f5 !important;
        }

        .popover-content .table th {
            background: #f5f5f5 !important;
            color: black;
        }

    #member-details {
        position: absolute;
        right: -300px;
        width: 300px;
        height: auto;
        background-color: #fff;
        z-index: 99;
        top: 0px;
        transition: all 0.3s ease-in;
        transition-delay: 0.1s;
        transition-duration: 0.3s;
        color: #fff;
        font-size: 11px;
        border: 1px solid #3d3d3f;
        border-radius: 0;
        margin: 0;
    }

        #member-details.active {
            right: 0;
        }

        #member-details .table {
            border: 0px solid #388851;
            padding: 0px;
            margin: 0px;
            border-collapse: collapse;
            max-width: 100%;
        }


            #member-details .table td, #member-details .table th {
                /*padding: 2px 2px 2px 2px;*/
                border-collapse: collapse;
                border-bottom: none;
                word-wrap: break-word;
                border: 0;
            }

            #member-details .table.table-sm.detail th, #member-details .table.table-sm.detail td {
                border-right: 1px solid #3d3d3f;
            }

            #member-details .table.table-sm.detail {
                border-bottom: 1px solid #3d3d3f !important;
            }

            #member-details .table th {
                color: black;
            }

    .family-tree li a .outer-ring {
        border: 1px solid #d78a2e;
        padding: 5px;
        text-decoration: none;
        color: #666;
        font-family: arial, verdana, tahoma;
        font-size: 11px;
        display: inline-block;
        border-radius: 50%;
        -webkit-border-radius: 50%;
        -moz-border-radius: 50%;
        transition: all 0.5s;
        -webkit-transition: all 0.5s;
        -moz-transition: all 0.5s;
    }

    #loading-image {
        display: none;
        position: absolute;
        color: #fff;
        background-color: #000000;
        top: 0;
        left: 0px;
        bottom: 0;
        width: 100%;
        height: 100%;
        text-align: center;
        padding-top: 75%;
    }

    #go-top i.material-icons {
        font-size: 24px;
    }


    i.men-active {
        width: 50px !important;
        height: 50px !important;
        background-image: url(../../images/TreeIcon/men-active.png) !important;
        display: block;
        margin: 0 auto;
    }

    i.men-inactive {
        width: 50px !important;
        height: 50px !important;
        background-image: url(../../images/TreeIcon/men-inactive.png) !important;
        display: block;
        margin: 0 auto;
    }

    i.girl-active {
        width: 50px !important;
        height: 50px !important;
        background-image: url(../../images/TreeIcon/girl-active.png) !important;
        display: block;
        margin: 0 auto;
    }

    i.girl-inactive {
        width: 50px !important;
        height: 50px !important;
        background-image: url(../../images/TreeIcon/girl-inactive.png) !important;
        display: block;
        margin: 0 auto;
    }

    i.join-member {
        width: 50px !important;
        height: 50px !important;
        background-image: url(../../images/noimage.jpg) !important;
        display: block;
        margin: 0 auto;
    }

    i.open-member {
        width: 50px !important;
        height: 50px !important;
        background-image: url(../../images/noimage.jpg) !important;
        display: block;
        margin: 0 auto;
    }

    i.girl-block {
        width: 50px !important;
        height: 50px !important;
        background-image: url(../../images/TreeIcon/girl-block.png) !important;
        display: block;
        margin: 0 auto;
    }

    i.men-block {
        width: 50px !important;
        height: 50px !important;
        background-image: url(../../images/TreeIcon/men-block.png) !important;
        display: block;
        margin: 0 auto;
    }

    #lblDisplayName {
        font-size: 18px;
        padding: 5px 5px 10px;
        font-weight: 500;
        text-transform: uppercase;
        text-align: left;
        margin: 0px;
        border-bottom: 1px solid #3d3d3f;
    }

    .loading-image.member-img {
        padding: 0 10px;
    }

    #member-details button#close {
        text-shadow: none;
        color: #929294;
        opacity: 1;
        width: 25px;
        height: 25px;
        position: absolute;
        top: 6px;
        font-size: 25px;
        line-height: 7px;
        right: 0;
        border: 0;
        background-color: #29292b;
        display: block !important;
    }

    #close, .next-tree {
        display: none;
    }

    #member-details button#close:focus, #member-details button#close:active, #member-details button#close:hover {
        outline: none;
    }

    .next-tree i {
        border: solid #929294;
        border-width: 0 2px 2px 0;
        display: inline-block;
        padding: 3px;
    }

    #member-details button.next-tree {
        width: 25px;
        height: 25px;
        position: absolute;
        top: 5px;
        font-size: 25px;
        line-height: 0px;
        left: 0;
        border: 0;
        background-color: #29292b;
        display: block !important;
    }

        #member-details button.next-tree .down {
            transform: rotate(45deg);
            -webkit-transform: rotate(45deg);
        }

    @@media (max-width: 768px) {
        #member-details .table {
            width: 100% !important;
        }
    }

    @@media (max-width: 992px) {
        .text-right.mob-text-center {
            text-align: center;
            margin-bottom: 15px;
        }

        .text-center.mob-search-box {
            width: calc(100% - 95px);
            float: left;
            padding-left: 0 !important;
        }

        .text-left.mob-search-btn {
            width: 95px;
            padding: 0 !important;
            float: left;
        }
    }
    /* .family-tree li a .outer-ring.block-member{
        border: 1px solid #a24d34;
    }
    .family-tree .member-img.block-member {
        border: 2px solid #b33c18;
    }*/
</style>
<style>
    #divload {
        width: 100%;
        height: 100%;
        position: fixed;
        z-index: 9999;
        background: url("https://www.creditmutuel.fr/cmne/fr/banques/webservices/nswr/images/loading.gif") no-repeat center center rgba(0,0,0,0.25);
    }

    .member-data-detail table.table-sm {
        font-size: 8px !important;
    }

    .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
        border-top: 1px solid rgba(120,130,140,.13);
        line-height: 10px;
        vertical-align: top;
    }
</style>
<div class="loader" id="divload"></div>
<div class="page-header page-header-light">
    <div class="page-header-content header-elements-md-inline">
        <div class="page-title d-flex">
            <h4><i class="icon-arrow-left52 mr-2"></i> <span class="font-weight-semibold">Team </span> - Tree</h4>
            <a href="#" class="header-elements-toggle text-default d-md-none"><i class="icon-more"></i></a>
        </div>
    </div>
</div>
<br />
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="form-row">
                        <div class="col-md-2"></div>

                        <div class="col-md-4">
                            <input name="txtLoginID" type="text" maxlength="10" id="txtLoginID" class="form-control" placeholder="Search By Login ID" autocomplete="off">
                        </div>
                        <div class="col-md-4">
                            <input type="hidden" name="hfCustomerId" id="hfCustomerId">
                            <input type="hidden" name="HiddenField1" id="HiddenField1">
                            <button type="button" id="btnSearch" class="btn btn-success m-b-10 m-l-5">Search</button>
                            <a id="linkGoUp" class="btn btn-info m-b-10 m-l-5" style="display:none">
                                <input type="hidden" id="lblRequest" />Go Up
                            </a>
                            <a id="btnRoot" class="btn btn-primary m-b-10 m-l-5">Root</a>
                        </div>
                        <div class="form-group col-md-12">
                            <div class="col-sm-12 col-md-12" id="chart">
                                <div class="tree family-tree clearfix">
                                    <ul>
                                        <li id="firstRow">
                                            <a href="" id="firstHead"></a>
                                            <input type="hidden" id="lblFk_UserId" />
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<input type="hidden" id="firtsMemberID" value="@ViewBag.Fk_UserId" />

<script src="../../AssociateAssets/global_assets/js/main/jquery.min.js"></script>
<script type="text/javascript">
    var winHeight = $(window).height();
    var winWidth = $(window).width();

    $("body").click(function () {
        $("a").popover('hide');
    });
    $("a").click(function () {
        $("a").popover('hide');
    });

    if (winWidth > 998) {
        $("#chart").on("mouseover", function () {
        });
        $("#chart").on("mouseout", function () {
        });
    }

    var Fk_UserId = "0";
    $("#btnRoot").click(function () {

        var loginid = $("#firtsMemberID").val();
        var topId = $("#linkGoUp").find("#lblRequest").val();
        if (parseInt(loginid) > parseInt(topId)) {
        }
        else {
            GetDataFirst(loginid, "clicked");
            $("#txtLoginID").val('');
            $("#hfCustomerId").val('');
        }

    });

    $("#linkGoUp").click(function () {
        $('#divload').show();
        $("#linkGoUp").attr("readonly", true);

        if ($(this).find("#lblRequest").val() == "0") {
            $('#divload').hide();
        }
        else {
            if (parseInt($(this).find("#lblRequest").val()) < parseInt($("#firtsMemberID").val())) {
            } else {
                Fk_UserId = $(this).find("#lblRequest").val();
                GetDataFirst(Fk_UserId, "clicked");
            }
        }
        // GetData(Fk_UserId);
    });


    var Fk_UserId = "0";
    var clicked = 0;

    

</script>

<script type="text/javascript">

    var winHeight = $(window).height();
    var winWidth = $(window).width();
    var clickOption = "";
    if (winWidth < 980) {
        //clickOption = "";
        clickOption = "";
    }
    else {
        clickOption = "onClick='ClickHere(this)'";
    }



    $(window).on("load", function () {

        var id = $("#firtsMemberID").val();

        GetDataFirst(id, "clicked");

        //GetData(id);

    });

    function GetData(id) {
        //
        $.ajax({
            method: "GET",
            url: window.location.origin + "/AgentServices/GetGeneologyForAdmin?memID=" + id,
            success: OnSuccess,
            failure: function (response) {
                console.log("Failed: " + response);
                console.log(response);
            },
            error: function (response) {
                console.log("Error: " + response);
                console.log(response);
            }
        });


        function OnSuccess(response) {
            debugger;
            var ul = $("<ul></ul>");
            var freeBlock = "";
            var freeBlock1 = "";
            var freeBlock2 = "";
            var freeBlock3 = "";
            var freeBlock4 = "";
            var freeBlock5 = "";
            var model = response;
            debugger;
            if (!$.trim(model)) {

                $(".alert-warning").show();
                $("#lblWarning").text("No Member Found...For this Associate");
                //$("#userTree").hide();
                freeBlock1 = "<li id='1'><a id='levelLink1' href='javascript:void(0)' class='from join-member rounded-circle'><div class='outer-ring join-member rounded-circle'><div class='member-img join-member rounded-circle'><i class='join-member  rounded-circle'></i></div></div><span class='name member-name'> Open</span> <span class='member-join-time'> </span></a></li>";
                freeBlock2 = "<li id='2'><a id='levelLink1' href='javascript:void(0)' class='from join-member rounded-circle'><div class='outer-ring join-member rounded-circle'><div class='member-img join-member rounded-circle'><i class='join-member  rounded-circle'></i></div></div><span class='name member-name'> Open</span> <span class='member-join-time'> </span></a></li>";
                freeBlock3 = "<li id='2'><a id='levelLink1' href='javascript:void(0)' class='from join-member rounded-circle'><div class='outer-ring join-member rounded-circle'><div class='member-img join-member rounded-circle'><i class='join-member  rounded-circle'></i></div></div><span class='name member-name'> Open</span> <span class='member-join-time'> </span></a></li>";
                freeBlock4 = "<li id='2'><a id='levelLink1' href='javascript:void(0)' class='from join-member rounded-circle'><div class='outer-ring join-member rounded-circle'><div class='member-img join-member rounded-circle'><i class='join-member  rounded-circle'></i></div></div><span class='name member-name'> Open</span> <span class='member-join-time'> </span></a></li>";
                freeBlock5 = "<li id='2'><a id='levelLink1' href='javascript:void(0)' class='from join-member rounded-circle'><div class='outer-ring join-member rounded-circle'><div class='member-img join-member rounded-circle'><i class='join-member  rounded-circle'></i></div></div><span class='name member-name'> Open</span> <span class='member-join-time'> </span></a></li>";
                ul.append(freeBlock1 + freeBlock2 + freeBlock3 + freeBlock4 + freeBlock5);
                $("#firstRow").fadeIn(500);
                window.setTimeout(function () {
                    $('#alertbox .alert').hide(500, 0).slideUp(1500, function () {
                        $('#alertbox .alert').slideUp(500);
                    });
                }, 2000);

            }
            else {
                var $child = "";
                var level = 0;
                $.each(response, function (i, k) {
                    level++;
                });
                $.each(model, function (i, item1) {
                    id = item1.Fk_UserId;
                    var cssclass = "";
                    var cssclaa = item1.CssClass;
                    var Gender = item1.Gender;
                    if (cssclaa == "active-member") {
                        if (Gender == "M") {
                            cssclass = "men-active";
                        }
                        else {
                            cssclass = "girl-active";
                        }
                    }
                    else if (cssclaa == "block-member") {
                        if (Gender == "M") {
                            cssclass = "men-block";
                        }
                        else {
                            cssclass = "girl-block";
                        }
                    }
                    else if (cssclaa == "inactive-member") {
                        if (Gender == "M") {
                            cssclass = "men-inactive";
                        }
                        else {
                            cssclass = "girl-inactive";
                        }
                    }
                    else {
                        cssclass = "join-member";
                    }

                    if (level == 5) {
                        debugger;
                        if (id != '-1') {

                            child = " <li id='level" + i + "'><a data-toggle='popover' id='levelLink" + i + "' href='" + item1.Href + "' class='from " + cssclass + " rounded-circle' onclick='ClickHere(this," + item1.Fk_UserId + ")')><div class='outer-ring " + cssclass + " rounded-circle'><div class='member-img " + cssclass + " rounded-circle'><i class='" + cssclass + " rounded-circle '></i></div></div><span class='name member-name'>" +
                                                      " " + item1.LoginId + "</span> <span class='member-join-time'> " + item1.MemberName + "</span>" +
                                                      "<input type='hidden' id='" + item1.Fk_UserId + "' value='" + item1.Fk_UserId + "' />" +
                                                      "</a></li>";
                        }
                        else {

                            child = " <li id='level" + i + "'><a id='levelLink" + i + "' href='" + item1.Href + "' class='from " + cssclass + " rounded-circle' onclick='ClickHere(this," + item1.Fk_UserId + ")'><div class='outer-ring " + cssclass + " rounded-circle'><div class='member-img " + cssclass + " rounded-circle'><i class='" + cssclass + "  rounded-circle'></i></div></div><span class='name member-name'>" +
                                                     " " + item1.LoginId + "</span> <span class='member-join-time'> " + item1.MemberName + "</span>" +
                                                     "<input type='hidden' id='" + item1.Fk_UserId + "' value='" + item1.Fk_UserId + "' />" +
                                                     "</a></li>";
                        }
                        ul.append(child);
                    }
                    else {
                        if (id != '-1') {
                            child = " <li id='level" + i + "'><a data-toggle='popover' id='levelLink" + i + "' href='" + item1.Href + "' class='from " + cssclass + " rounded-circle' onclick='ClickHere(this," + item1.Fk_UserId + ")' ><div class='outer-ring " + cssclass + " rounded-circle'><div class='member-img " + cssclass + " rounded-circle'><i class='" + cssclass + " rounded-circle'></i></div></div><span class='name member-name'>" +
                                                      " " + item1.LoginId + "</span> <span class='member-join-time'> " + item1.MemberName + "</span>" +
                                                      "<input type='hidden' id='" + item1.Fk_UserId + "' value='" + item1.Fk_UserId + "' />" +
                                                      "</a></li>";
                        }
                        else {
                            child = " <li id='level" + i + "'><a id='levelLink" + i + "' href='" + item1.Href + "' class='from " + cssclass + " rounded-circle' onclick='ClickHere(this," + item1.Fk_UserId + ")'>" +
                                                     "<div class='outer-ring " + cssclass + " rounded-circle'><div class='member-img " + cssclass + " rounded-circle'><i class='" + cssclass + " rounded-circle'></i></div></div><span class='name member-name'>" +
                                                     " " + item1.LoginId + "</span> <span class='member-join-time'> " + item1.MemberName + "</span>" +
                                                     "<input type='hidden' id='" + item1.Fk_UserId + "' value='" + item1.Fk_UserId + "' />" +
                                                     "</a></li>";
                        }
                        freeBlock = "<li id='1'><a href='Registration.cshtml?Pid=" + item1.LoginId + "&amp;lg=" + item1.Leg + "' target='_blank'><img src='/Content/img/open-member.png'><br><span>Join Now</span></a></li>";
                        debugger;
                        if (item1.Leg == '') {
                            ul.append(freeBlock + child);
                        }
                        else {
                            ul.append(child);
                        }
                    }
                });
                $("#firstRow").append(ul);
            }
            $("#firstRow").append(ul);
            $('#divload').hide();
        }
    }
    function ClickHere(obj,Id) {
        debugger;
        $("#member-details").removeClass('active');
        $("#lblFk_UserId").text(Id);
        clicked = 1;
        GetDataFirst(Id, "clicked");
    }


    $("#close").click(function () {
        $("#member-details").removeClass('active');
    });

    function openPopup(obj, item1) {
        debugger;
        $("#lblFk_UserId").text(item1);
    }
    function GetDataFirst(id, text) {
        $('#divload').show();
        $.ajax({
            "method": "GET",
            url: window.location.origin + "/AgentServices/GetUserFirstForAdmin?memID=" + id,
            success: OnSuccess2,

            failure: function (response) {
                $('#divload').hide();
            },
            error: function (response) {
                $('#divload').hide();
            }
        });
        function OnSuccess2(response) {
            debugger;
            var modal = response;
            $.each(modal, function (i, item) {
                debugger;
                $("#headClass span").text(item.MemberName + "(" + item.LoginId + ")");
                var status = item.Status;
                var gender = item.Gender;

                var cssclaa = '';

                if (status == "T") {
                    cssclaa = "inactive-member"
                }
                else if (status == "P") {
                    cssclaa = "active-member"
                }
                else {
                    cssclaa = "block-member"
                }

                if (status == "T") {
                    if (gender == "M") {
                        status = "men-inactive"
                    }
                    else {
                        status = "girl-inactive"
                    }
                }
                else if (status == "P") {

                    if (gender == "M") {
                        status = "men-active"
                    }
                    else {
                        status = "girl-active"
                    }
                }
                else {
                    if (gender == "M") {
                        status = "men-block"
                    }
                    else {
                        status = "girl-block"
                    }
                }
                var $firstHead = $("#firstHead");
                $firstHead.html("<div class='outer-ring " + status + "'><div class='member-img " + status + "'><i class='" + status + " rounded-circle'></i></div></div><span class='name member-name'>" + item.LoginId + "</span><span class='member-join-time'>" + item.MemberName + "</span>");
                $("#firstHead").attr("class", status);
                $("#firstHead").attr("style", "opacity: 1;");
                $("#firstHead").attr("href", "#");
                $("#lblRequest").val(item.ParentId);
                if (text == "clicked") {
                    $("#firstRow").html('');
                    $("#firstRow").append($firstHead);
                    GetData(item.Fk_UserId);
                }
            });
            $("#linkGoUp").attr("readonly", false);

        }
    }
    $(function () {
        $("#btnSearch").click(function () {
            if ($("#txtLoginID").val() != "") {
                $.ajax({
                    url: window.location.origin + '/AgentServices/SearchCustomersByLoginId2?prefix=' + $("#txtLoginID").val(),
                    //data: "{ 'prefix': '" + $("#txtLoginID").val() + "'}",
                    //dataType: "json",
                    method: "GET",
                    //contentType: "application/json; charset=utf-8",
                    success: OnSuccessThis,
                    error: function (response) {
                        debugger;
                        console.log(response.responseText);
                    },
                    failure: function (response) {
                        debugger;
                        console.log(response.responseText);
                    },
                    select: function (e, i) {
                        $("[id$=hfCustomerId]").val(i.item.val);
                    },
                });
            }


            function OnSuccessThis(data) {
                debugger;
                console.log(data);
                var r = data;
                $(r).each(function () {
                    $("[id$=hfCustomerId]").val(this.split('.')[1]);
                    if ($("#hfCustomerId").val() != "") {
                        if ($("#txtLoginID").val() == "") {
                            Fk_UserId = $("#firtsMemberID").val();

                        }
                        else {
                            Fk_UserId = $("#hfCustomerId").val();
                            $("#firstRow").find('ul').remove();
                            GetDataFirst(Fk_UserId);
                            GetData(Fk_UserId);
                        }
                    }
                })
            }
        });
    });

</script>